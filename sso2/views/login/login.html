<!DOCTYPE html>
<html>
<head>
    <title>Login</title>
    <link rel="stylesheet" href="/static/css/semantic.min.css"/>
    <script src="/static/js/lib.min.js"></script>
    <script src="/static/js/md5.js"></script>
    <style>
        *{ font:12pt Verdana,Arial,Microsoft YaHei,sans-serif; color:#666666; word-wrap:break-word;}
        #screen{margin:0 auto; width:420px; margin-top:100px; }
        .field label {font-weight: bold;}
        .ui.message .header {font-size: 1em;}
    </style>
    <script type="text/javascript">
		function getCookie(c_name)
			{
				if (document.cookie.length>0)
  				 {
 				   c_start=document.cookie.indexOf(c_name + "=")
 				   if (c_start!=-1)
    				{ 
   					 c_start=c_start + c_name.length+1 
    				 c_end=document.cookie.indexOf(";",c_start)
      			     if (c_end==-1) c_end=document.cookie.length
    					return unescape(document.cookie.substring(c_start,c_end))
   				    } 
  			    }
			return ""
			}
        function login() {
			rands = getCookie('rand')
			//alert(rands)
            var name = $("#name").val()
            var password = $("#password").val()
            if (name.length == 0) {
                $("#err .header").html("用户名不能为空");
                $("#err").show("fast");
                return false;
            }

            if (password.length == 0) {
                $("#err .header").html("密码不能为空");
                $("#err").show("fast");
                return false;
            }
			pass = CryptoJS.MD5(password)
			pass += rands
            $.post("{{urlfor "LoginController.DoLogin"}}", {"name":name, "password": CryptoJS.MD5(pass)+''}, function(data){
                if (data.length == 0) {
					//alert("OK")
                    window.location.href="/";
                } else {
					alert(data)
                    $("#err .header").html(data);
                    $("#err").show("fast");
					 window.location.href="/login";
                }
            });
        }
        $(function(){
            $("#name").keypress(function(e){ 
                $("#err").hide("fast");
                if(e.keyCode==13){
                    login();
                }
            });
            $("#password").keypress(function(e){
                $("#err").hide("fast");
                if(e.keyCode==13){
                   login();
                }
            });
        });
    </script>
</head>
<body>
    <div id="screen">
        <div class="ui form segment">
            <div class="field">
                <label>用户名</label>
                <div class="ui left labeled icon input">
                    <input type="text" placeholder="Username" id="name">
                    <i class="user icon"></i>
                    <div class="ui corner label">
                        <i class="icon asterisk"></i>
                    </div>
                </div>
            </div>
            <div class="field">
                <label>密码</label>
                <div class="ui left labeled icon input">
                    <input type="password" id="password">
                    <i class="lock icon"></i>
                    <div class="ui corner label">
                        <i class="icon asterisk"></i>
                    </div>
                </div>
            </div>
            <div class="ui error message" id="err">
                <div class="header"></div>
            </div>
            <a class="ui blue submit button" id="login" href="javascript:login();">登陆</a>
        </div>
    </div>
</body>
</html>
